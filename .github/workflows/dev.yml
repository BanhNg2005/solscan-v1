# Deploy branch dev to dev environment
#
# To get started with Next.js see: https://nextjs.org/docs/getting-started
#

name: DEV CI/CD UI V2

on:
  # Runs on pushes targeting the default branch
  push:
    branches: ['banh']

jobs:
  deploy:
    runs-on: ubuntu-22.04
    steps:
      - name: Deploy Solscan Dev Server
        uses: appleboy/ssh-action@v1.0.3
        with:
          host: ${{ secrets.DEV_DEPLOY_HOST }}
          username: ${{ secrets.DEV_DEPLOY_USER }}
          password: ${{ secrets.DEV_DEPLOY_PASSWORD }}
          port: 22
          script: |
            echo "=== Testing NVM paths ==="
            echo "HOME: $HOME"
            echo "USER: $USER"
            
            # Test different NVM paths
            if [ -f "$HOME/.nvm/nvm.sh" ]; then
              echo "✅ Found NVM at: $HOME/.nvm/nvm.sh"
              source "$HOME/.nvm/nvm.sh"
            elif [ -f "/home/banh/.nvm/nvm.sh" ]; then
              echo "✅ Found NVM at: /home/banh/.nvm/nvm.sh"
              source "/home/banh/.nvm/nvm.sh"
            else
              echo "❌ NVM not found in expected locations"
              echo "Contents of ~/.nvm/:"
              ls -la ~/.nvm/ || echo "~/.nvm/ does not exist"
              exit 1
            fi
            
            echo "=== Testing Node/NPM ==="
            which node || echo "Node not in PATH"
            which npm || echo "NPM not in PATH"
            node --version || echo "Node command failed"
            npm --version || echo "NPM command failed"
